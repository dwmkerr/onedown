{"version":3,"sources":["app.js","services/errorservice.js","services/identityservice.js","menu/od-menu.js","components/od-crossword/od-crossword.js","components/od-notifications/od-notifications.js","pages/create/createcontroller.js","pages/crossword/crosswordcontroller.js","pages/crosswords/crosswordscontroller.js","pages/home/homecontroller.js"],"names":["app","angular","module","config","$routeProvider","when","templateUrl","controller","requiresLogin","resolve","crosswords","$http","ErrorService","get","then","response","data","error","crossword","$route","current","params","crosswordId","otherwise","authProvider","init","domain","clientID","callbackURL","location","href","loginUrl","$httpProvider","jwtInterceptorProvider","tokenGetter","store","interceptors","push","run","auth","hookEvents","$rootScope","jwtHelper","$location","$on","isAuthenticated","token","isTokenExpired","path","authenticate","factory","this","errors","prototype","title","message","$q","IdentityService","ensureLoggedIn","deferred","defer","profile","signin","set","promise","directive","restrict","link","scope","login","logout","signout","remove","isLoggedIn","selectedClue","crosswordHeight","element","crosswordDom","CrosswordsJS","CrosswordDOM","selectClue","cleanupSelectedClueWatch","$watch","newValue","oldValue","undefined","onStateChanged","change","currentClue","$apply","destroy","$","crosswordElement","height","$scope","setter","solution","allClues","acrossClues","concat","downClues","clueMap","i","length","number","answers","clueCode","answer","crosswordModel","Crossword","isSelected","clue","save","clues","code","post","_id"],"mappings":"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","file":"app.min.js","sourcesContent":["var app = angular.module('app', ['ngRoute', 'auth0', 'angular-storage', 'angular-jwt'])\r\n  .config(function($routeProvider, $locationProvider) {\r\n\r\n    $routeProvider\r\n      .when('/create', {\r\n        templateUrl: 'app/pages/create/create.html',\r\n        controller: 'CreateController',\r\n        requiresLogin: true\r\n      })\r\n      .when('/crosswords', {\r\n        templateUrl: 'app/pages/crosswords/crosswords.html',\r\n        controller: 'CrosswordsController',\r\n        resolve: {\r\n          crosswords: function($http, ErrorService) {\r\n            return $http.get('api/crosswords').then(function(response) { \r\n              return response.data; \r\n            }, function(err) {\r\n              ErrorService.error('Sorry', 'There was a problem loading the crosswords.');\r\n            });\r\n          }\r\n        }\r\n      })\r\n      .when('/crosswords/:crosswordId', {\r\n        templateUrl: 'app/pages/crossword/crossword.html',\r\n        controller: 'CrosswordController',\r\n        resolve: {\r\n          crossword: function($route, $http) {\r\n            return $http.get('api/crosswords/' + $route.current.params.crosswordId).then(function(response) { \r\n              return response.data; \r\n            }, function(err) {\r\n              ErrorService.error('Sorry', 'There was a problem loading the crossword.');\r\n            });\r\n          }\r\n        }\r\n      })\r\n      .otherwise({\r\n        templateUrl: 'app/pages/home/home.html',\r\n        controller: 'HomeController'\r\n      });\r\n\r\n  })\r\n  .config(function (authProvider) {\r\n    authProvider.init({\r\n      domain: 'dwmkerr.auth0.com',\r\n      clientID: 'oWeXhqDS5VLh8asTvNUEqKFA6wIbGIsJ',\r\n      callbackURL: location.href,\r\n      // Here we add the URL to go if the user tries to access a resource he can't because he's not authenticated\r\n      loginUrl: '/login'\r\n    });\r\n  })\r\n  .config(function (authProvider, $httpProvider, jwtInterceptorProvider) {\r\n\r\n    // We're annotating this function so that the `store` is injected correctly when this file is minified\r\n    jwtInterceptorProvider.tokenGetter = ['store', function(store) {\r\n      // Return the saved token\r\n      return store.get('token');\r\n    }];\r\n\r\n    $httpProvider.interceptors.push('jwtInterceptor');\r\n  })\r\n  .run(function(auth) {\r\n    // This hooks al auth events to check everything as soon as the app starts\r\n    auth.hookEvents();\r\n  })\r\n  .run(function($rootScope, auth, store, jwtHelper, $location) {\r\n    // This events gets triggered on refresh or URL change\r\n    $rootScope.$on('$locationChangeStart', function() {\r\n      if (!auth.isAuthenticated) {\r\n        var token = store.get('token');\r\n        if (token) {\r\n          if (!jwtHelper.isTokenExpired(token)) {\r\n            auth.authenticate(store.get('profile'), token);\r\n          } else {\r\n            // Either show Login page or use the refresh token to get a new idToken\r\n            $location.path('/');\r\n          }\r\n        }\r\n      }\r\n    });\r\n  });","angular.module('app').factory('ErrorService', function() {\r\n\r\n  function ErrorService() {\r\n\r\n    this.errors = [];\r\n\r\n  }\r\n\r\n  //  Logs an error.\r\n  ErrorService.prototype.error = function error(title, message) {\r\n    \r\n    this.errors.push({\r\n      title: title,\r\n      message: message\r\n    });\r\n\r\n  };\r\n\r\n  return new ErrorService();\r\n});","angular.module('app').factory('IdentityService', function($q, auth, store) {\r\n\r\n  function IdentityService() {\r\n\r\n  }\r\n\r\n  //  Returns a promise resolved immediately with the profile if logged in,\r\n  //  or after login otherwise. Rejected for login failure.\r\n  IdentityService.prototype.ensureLoggedIn = function ensureLoggedIn() {\r\n    \r\n    var deferred = $q.defer();\r\n    if(auth.isAuthenticated) {\r\n      deferred.resolve(auth.profile);\r\n    } else {\r\n      auth.signin({}, function(profile, token) {\r\n        store.set('profile', profile);\r\n        store.set('token', token);\r\n        deferred.resolve(profile);\r\n      });\r\n    }\r\n    return deferred.promise;\r\n\r\n  };\r\n\r\n  return new IdentityService();\r\n});","angular.module('app').directive('odMenu', function($location, auth, store, IdentityService) {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'app/menu/od-menu.html',\r\n    link: function(scope, element, attrs) {\r\n\r\n      scope.auth = auth;\r\n\r\n\r\n      scope.login = function() {\r\n        IdentityService.ensureLoggedIn();\r\n      };\r\n\r\n      scope.logout = function() {\r\n        auth.signout();\r\n        store.remove('profile');\r\n        store.remove('token');\r\n      };\r\n\r\n      scope.isLoggedIn = function() {\r\n        return auth.isAuthenticated;\r\n      };\r\n\r\n    }\r\n  };\r\n});","angular.module('app').directive('odCrossword', function() {\r\n\r\n  return {\r\n    restrict: \"E\",\r\n    templateUrl: \"app/components/od-crossword/od-crossword.html\",\r\n    scope: {\r\n      crossword: \"=\",\r\n      selectedClue: \"=\",\r\n      crosswordHeight: \"=\"\r\n    },\r\n    link: function(scope, element, attributes) {\r\n\r\n      //  Create the crossword DOM.\r\n      var crosswordDom = new CrosswordsJS.CrosswordDOM(scope.crossword, element[0]);\r\n\r\n      //  Set the selection if we have one.\r\n      if(scope.selectedClue) {\r\n        crosswordDom.selectClue(scope.selectedClue);\r\n      }\r\n      \r\n      //  Update the selected clue when needed.\r\n      var cleanupSelectedClueWatch = scope.$watch('selectedClue', function(newValue, oldValue) {\r\n        if(newValue !== oldValue && newValue !== undefined) {\r\n          crosswordDom.selectClue(scope.selectedClue);\r\n        }\r\n      });\r\n\r\n      //  Watch for notifications.\r\n      crosswordDom.onStateChanged = function(change) {\r\n        //  TODO: selecting a clue fires a state change message.\r\n        if(change.message === \"clueSelected\") {\r\n          if(scope.selectedClue !== crosswordDom.currentClue) {\r\n            scope.selectedClue = crosswordDom.currentClue;\r\n            scope.$apply();\r\n          }\r\n        }\r\n      };\r\n\r\n      //  Cleanup on scope destroy.\r\n      scope.$on('$destroy', function() {\r\n        cleanupSelectedClueWatch();\r\n        crosswordDom.destroy();\r\n      });\r\n\r\n      scope.crosswordHeight = $(crosswordDom.crosswordElement).height();\r\n\r\n    }\r\n  };\r\n\r\n});","angular.module('app').directive('odNotifications', function(ErrorService) {\r\n\r\n  return {\r\n    restrict: \"E\",\r\n    templateUrl: \"app/components/od-notifications/od-notifications.html\",\r\n    scope: {\r\n    },\r\n    link: function(scope, element, attributes) {\r\n\r\n      scope.errors = ErrorService.errors;    \r\n\r\n    }\r\n  };\r\n\r\n});","angular.module('app').controller('CreateController', function($scope) {\r\n\r\n});","angular.module('app').controller('CrosswordController', function($scope, $q, $http, auth, IdentityService, ErrorService, crossword) {\r\n\r\n\r\n  $scope.title = crossword.title;\r\n  $scope.setter = crossword.setter;\r\n\r\n  //  Our crossword might contain a solution. If it does, but each answer in the clue\r\n  //  (which is the shape required by the CrosswordsJS class).\r\n  if(crossword.solution) {\r\n\r\n    var allClues = crossword.acrossClues.concat(crossword.downClues);\r\n    var clueMap = {};\r\n    for(var i=0; i<allClues.length; i++) {\r\n      clueMap[allClues[i].number + (i < crossword.acrossClues.length ? 'a' : 'd')] = allClues[i];\r\n    }\r\n\r\n    for(i=0; i<crossword.solution.answers.length; i++) {\r\n      clueMap[crossword.solution.answers[i].clueCode].answer = crossword.solution.answers[i].answer;\r\n    }\r\n  }\r\n\r\n  //  Create the crossword model from the crossword definition. (TODO in router?)\r\n  var crosswordModel = new CrosswordsJS.Crossword(crossword);\r\n  $scope.crossword = crosswordModel;  \r\n  $scope.acrossClues = crosswordModel.acrossClues;\r\n  $scope.downClues = crosswordModel.downClues;\r\n\r\n  $scope.isSelected = function isSelected(clue) {\r\n    return clue === $scope.selectedClue;\r\n  };\r\n\r\n  $scope.selectClue = function selectClue(clue) {\r\n    $scope.selectedClue = clue;\r\n  };\r\n\r\n  $scope.save = function save() {\r\n    //  If we are going to save we'd better be logged in.\r\n    IdentityService.ensureLoggedIn().then(function() {\r\n      \r\n      //  Build a solution to send.\r\n      var solution = {\r\n        answers: []\r\n      };\r\n\r\n      //  Go though the model and pull out all clues.\r\n      var clues = crosswordModel.acrossClues.concat(crosswordModel.downClues);\r\n      for(var i=0; i<clues.length; i++) {\r\n        if(clues[i].answer) {\r\n          solution.answers.push({\r\n            clueCode: clues[i].code,\r\n            answer: clues[i].answer\r\n          });\r\n        }\r\n      }\r\n      $http.post('api/crosswords/' + crossword._id + '/solution', solution).then(function() {\r\n\r\n      }, function(err) {\r\n        ErrorService('Sorry', 'There was a problem saving your answers.');\r\n      });\r\n\r\n    });\r\n  };\r\n\r\n\r\n\r\n});","angular.module('app').controller('CrosswordsController', function($scope, crosswords) {\r\n\r\n  $scope.crosswords = crosswords;\r\n\r\n});","angular.module('app').controller('HomeController', function() {\r\n\r\n});"],"sourceRoot":"/source/"}